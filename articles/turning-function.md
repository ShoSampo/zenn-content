---
title: "Turning Functionとアフィン変換を用いた地図ポリゴンの形状マッチング"
emoji: "🗺️"
type: "tech"
topics: ["GIS", "Python", "ComputerVision", "幾何学", "アルゴリズム"]
published: true
published_at: 2024-12-03
---

# はじめに

地図データの位置合わせは、GISの分野における重要な課題の一つです。

本記事では、Turning Function（回転関数）を用いた幾何学的な手法により、２つの微妙に形状が異なるポリゴンの位置合わせを行う手法について解説します。

# 1. 形状分析手法
## 1.1 Turning Functionによる形状の特徴抽出

### Turning Functionとは
Turning Function（回転関数）は、ポリゴンの形状を1次元のステップ関数として表現する手法です。ポリゴンの境界に沿って反時計回りに進みながら、各頂点での接線の角度変化を累積的に記録していきます。

![](/images/turning-function/fig-1.png)

### 基本原理
1. **境界の走査**
   - ポリゴンの境界を反時計回りに走査
   - 開始点から終了点まで、境界に沿って移動

2. **関数の軸**
   - 横軸：境界上の位置（エッジの長さを外周長で正規化：[0,1]）
   - 縦軸：累積角度（反時計回りを正として累積）
      - 最終的な累積角度は2π（360度）に到達

3. **角度の累積**
   - 各頂点で内角に基づく角度変化を記録
   - ステップ関数として表現される
   - 頂点間（エッジ上）では角度は一定


### 具体例

**単純な正方形の場合：**

- 各頂点で90度（π/2）ずつ増加
- 4つの頂点で合計360度（2π）
- エッジの長さは全て等しいため、横軸上で等間隔にステップが現れる

![](/images/turning-function/fig-2.png)

**円に近い多角形の場合：**

- 各頂点での角度変化とエッジの長さが小さいため、ほぼ直線となる

![](/images/turning-function/fig-5.png)

**星型の場合：**

- 角度の変化が多いため、ステップ関数の形状が複雑になる
- 角度の変化が負になる（時計回り）頂点が存在するため、ステップ関数が下る箇所が存在する

![](/images/turning-function/fig-3.png)

### 不変性の重要性

Turning Functionの重要な特徴は、以下の変換に対して不変であることです：

1. **回転に対する不変性**
   - ポリゴンを回転させても同じ関数が得られる
   - 向きの異なるポリゴンの比較が可能

2. **平行移動に対する不変性**
   - 位置が異なっても同じ関数が得られる
   - 絶対座標に依存しない比較が可能

3. **スケールに対する不変性**
   - サイズの異なるポリゴンでも比較可能
   - 正規化により相対的な形状を評価

以下のプロットのように、回転、平行移動、スケール変換に対して不変であるため、形状が同じ２つのポリゴンのTurning Functionがぴったりと重なっていることがわかります。

![](/images/turning-function/fig-4.png)
### 形状の数値化がもたらす利点

1. **定量的な比較が可能**
   - 形状の類似度を数値として評価
   - 大量のポリゴンの比較に適用可能

2. **計算効率**
   - 2次元の形状を弧長と角度の関係を表す関数として表現
   - 形状の比較を関数の比較として扱える
     - 後述するL2ノルムを用いた類似度計算が可能



このような特徴により、Turning Functionはポリゴンデータの形状マッチングに適した手法となっています。

## 1.2 形状の類似度評価

### L2ノルムによる類似度計算

2つのポリゴンA, Bの形状の類似度は、それぞれのTurning function $T_A(l)$, $T_B(l)$ のL2ノルムを用いて計算できます。

#### 数式による定義
類似度（より正確には非類似度）$S(A,B)$は以下の式で定義されます：

$$S(A,B) = d(A,B) = \|T_A - T_B\|_2 = \left(\int_0^1(T_A(l) - T_B(l))^2\right)^{\frac{1}{2}}$$

ここで：
- $l$は正規化された累積長さ（0から1の範囲）
- $T_A(l)$, $T_B(l)$はそれぞれのポリゴンのTurning function
- $S(A,B)$は2つのポリゴン間の非類似度を表す

#### 特徴
1. **非類似度としての解釈**
   - $S(A,B)$の値が小さいほど、2つのポリゴンの形状は類似
   - 完全に同一の形状の場合、$S(A,B) = 0$

2. **対称性**
   - $S(A,B) = S(B,A)$が成り立つ
   - どちらのポリゴンを基準にしても同じ結果

3. **正規化の効果**
   - スケールに依存しない比較が可能
   - 回転に対して不変

この類似度計算により、形状の定量的な比較が可能となり、最も類似したポリゴンの組み合わせを自動的に特定することができます。

# 2. アフィン変換によるポリゴンマッチング
## 2.1 特徴点の抽出と評価
- 特徴的な角の定義方法
- 形状の特徴点抽出プロセス
- 特徴点の重要度評価

## 2.2 アフィン変換の適用
- 変換パラメータの推定
- 変換の適用と結果の評価
- 処理における制限事項

# まとめ
- 手法の特徴と利点
- 適用可能な場面と注意点
- 今後の課題
