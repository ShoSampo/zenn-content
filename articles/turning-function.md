---
title: "Turning Functionとアフィン変換を用いた地図ポリゴンの形状マッチング"
emoji: "🗺️"
type: "tech"
topics: ["GIS", "Python", "ComputerVision", "幾何学", "アルゴリズム"]
published: true
published_at: 2024-12-03
---

# はじめに

地図データの位置合わせは、GISの分野における重要な課題の一つです。

本記事では、Turning Function（回転関数）を用いた幾何学的な手法により、２つの微妙に形状が異なるポリゴンの位置合わせを行う手法について解説します。

# 1. 形状分析手法
## 1.1 Turning Functionによる形状の特徴抽出

### Turning Functionとは
Turning Function（回転関数）は、ポリゴンの形状を1次元のステップ関数として表現する手法です。ポリゴンの境界に沿って反時計回りに進みながら、各頂点での接線の角度変化を累積的に記録していきます。

![](/images/turning-function/fig-1.png)

### 基本原理
1. **境界の走査**
   - ポリゴンの境界を反時計回りに走査
   - 開始点から終了点まで、境界に沿って移動

2. **関数の軸**
   - 横軸：境界上の位置（エッジの長さを外周長で正規化：[0,1]）
   - 縦軸：累積角度（反時計回りを正として累積）
      - 最終的な累積角度は2π（360度）に到達

3. **角度の累積**
   - 各頂点で内角に基づく角度変化を記録
   - ステップ関数として表現される
   - 頂点間（エッジ上）では角度は一定


### 具体例

**単純な正方形の場合：**

- 各頂点で90度（π/2）ずつ増加
- 4つの頂点で合計360度（2π）
- エッジの長さは全て等しいため、横軸上で等間隔にステップが現れる

![](/images/turning-function/fig-2.png)

**星型の場合：**

- 角度の変化が多いため、ステップ関数の形状が複雑になる
- 角度の変化が負になる（時計回り）頂点が存在するため、ステップ関数が下る箇所が存在する

![](/images/turning-function/fig-3.png)

### 不変性の重要性

Turning Functionの重要な特徴は、以下の変換に対して不変であることです：

1. **回転に対する不変性**
   - ポリゴンを回転させても同じ関数が得られる
   - 向きの異なるポリゴンの比較が可能

2. **平行移動に対する不変性**
   - 位置が異なっても同じ関数が得られる
   - 絶対座標に依存しない比較が可能

3. **スケールに対する不変性**
   - サイズの異なるポリゴンでも比較可能
   - 正規化により相対的な形状を評価

以下のプロットのように、回転、平行移動、スケール変換に対して不変であるため、２つのTurning Functionがぴったりと重なっていることがわかります。

![](/images/turning-function/fig-4.png)
### 形状の数値化がもたらす利点

1. **定量的な比較が可能**
   - 形状の類似度を数値として評価
   - 大量のポリゴンの比較に適用可能

2. **計算効率**
   - 2次元の形状を弧長と角度の関係を表す関数として表現
   - 形状の比較を関数の比較として扱える
     - 後述するL2ノルムを用いた類似度計算が可能



このような特徴により、Turning Functionは形状マッチングに適した手法となっています。

## 1.2 形状の類似度評価
- L2ノルムを用いた類似度計算
- 特徴点間の対応付け
- 最適な対応関係の決定方法

# 2. アフィン変換によるポリゴンマッチング
## 2.1 特徴点の抽出と評価
- 特徴的な角の定義方法
- 形状の特徴点抽出プロセス
- 特徴点の重要度評価

## 2.2 アフィン変換の適用
- 変換パラメータの推定
- 変換の適用と結果の評価
- 処理における制限事項

# まとめ
- 手法の特徴と利点
- 適用可能な場面と注意点
- 今後の課題
